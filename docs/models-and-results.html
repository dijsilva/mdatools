<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Getting started with mdatools for R</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="This is a user guide for mdatools — R package for preprocessing, exploring and analysis of multivariate data. The package provides methods mostly common for Chemometrics. The general idea of the package is to collect most of the common chemometric methods and give a similar user interface for using them. So if a user knows how to make a model and visualise results for one method, he or she can easily do this for the others.">
  <meta name="generator" content="bookdown 0.1 and GitBook 2.6.7">

  <meta property="og:title" content="Getting started with mdatools for R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a user guide for mdatools — R package for preprocessing, exploring and analysis of multivariate data. The package provides methods mostly common for Chemometrics. The general idea of the package is to collect most of the common chemometric methods and give a similar user interface for using them. So if a user knows how to make a model and visualise results for one method, he or she can easily do this for the others." />
  <meta name="github-repo" content="svkucheryavski/mdatools.bookdown" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Getting started with mdatools for R" />
  
  <meta name="twitter:description" content="This is a user guide for mdatools — R package for preprocessing, exploring and analysis of multivariate data. The package provides methods mostly common for Chemometrics. The general idea of the package is to collect most of the common chemometric methods and give a similar user interface for using them. So if a user knows how to make a model and visualise results for one method, he or she can easily do this for the others." />
  

<meta name="author" content="Sergey Kucheryavskiy">

<meta name="date" content="2016-09-13">

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="partial-least-squares-regression.html">
<link rel="next" href="plotting-methods.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="what-is-new.html"><a href="what-is-new.html"><i class="fa fa-check"></i>What is new</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="" data-path="datasets-and-plots.html"><a href="datasets-and-plots.html"><i class="fa fa-check"></i>Datasets and plots</a></li>
<li class="chapter" data-level="1" data-path="placeholder.html"><a href="placeholder.html"><i class="fa fa-check"></i><b>1</b> Placeholder</a></li>
<li class="chapter" data-level="2" data-path="change-margin-for-bottom-part.html"><a href="change-margin-for-bottom-part.html"><i class="fa fa-check"></i><b>2</b> change margin for bottom part</a></li>
<li class="chapter" data-level="3" data-path="lets-create-a-small-subset-of-the-people-data.html"><a href="lets-create-a-small-subset-of-the-people-data.html"><i class="fa fa-check"></i><b>3</b> let’s create a small subset of the people data</a></li>
<li class="chapter" data-level="4" data-path="convert-image-to-a-data-matrix-and-add-some-attributed.html"><a href="convert-image-to-a-data-matrix-and-add-some-attributed.html"><i class="fa fa-check"></i><b>4</b> convert image to a data matrix and add some attributed</a></li>
<li class="chapter" data-level="5" data-path="get-data-and-exclude-column-income.html"><a href="get-data-and-exclude-column-income.html"><i class="fa fa-check"></i><b>5</b> get data and exclude column Income</a></li>
<li class="chapter" data-level="" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html"><i class="fa fa-check"></i>Principal component analysis</a></li>
<li class="chapter" data-level="" data-path="partial-least-squares-regression.html"><a href="partial-least-squares-regression.html"><i class="fa fa-check"></i>Partial least squares regression</a><ul>
<li class="chapter" data-level="" data-path="models-and-results.html"><a href="models-and-results.html"><i class="fa fa-check"></i>Models and results</a><ul>
<li class="chapter" data-level="" data-path="models-and-results.html"><a href="models-and-results.html#model-calibration"><i class="fa fa-check"></i>Model calibration</a></li>
<li class="chapter" data-level="" data-path="models-and-results.html"><a href="models-and-results.html#model-validation"><i class="fa fa-check"></i>Model validation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="plotting-methods.html"><a href="plotting-methods.html"><i class="fa fa-check"></i>Plotting methods</a><ul>
<li class="chapter" data-level="" data-path="plotting-methods.html"><a href="plotting-methods.html#support-for-images"><i class="fa fa-check"></i>Support for images</a></li>
<li class="chapter" data-level="" data-path="plotting-methods.html"><a href="plotting-methods.html#manual-x-values-for-loading-line-plot"><i class="fa fa-check"></i>Manual x-values for loading line plot</a></li>
<li class="chapter" data-level="" data-path="plotting-methods.html"><a href="plotting-methods.html#excluding-rows-and-columns"><i class="fa fa-check"></i>Excluding rows and columns</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Getting started with mdatools for R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="models-and-results" class="section level2 unnumbered">
<h2>Models and results</h2>
<p>Like we discussed in PCA, <em>matools</em> uses creates two types of objects — a model and a result. Every time you build a PLS model you get a <em>model object</em>. Every time you apply the model to a dataset you get a <em>result object</em>. For PLS, the objects have classes <code>pls</code> and <code>plsres</code> correspondingly.</p>
<div id="model-calibration" class="section level3 unnumbered">
<h3>Model calibration</h3>
<p>Let’s use the same <em>People</em> data and create PLS-model for prediction of <em>Shoesize</em> (column number four) using other 11 variables. As usual we start with preparing datasets (we will also split the data into calibration and test subsets):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mdatools)
<span class="kw">data</span>(people)

idx =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">4</span>, <span class="dv">32</span>, <span class="dv">4</span>)
X.c =<span class="st"> </span>people[-idx, -<span class="dv">4</span>, drop =<span class="st"> </span>F]
y.c =<span class="st"> </span>people[-idx, <span class="dv">4</span>]
X.t =<span class="st"> </span>people[idx, -<span class="dv">4</span>]
y.t =<span class="st"> </span>people[idx, <span class="dv">4</span>, drop =<span class="st"> </span>F]</code></pre></div>
<p>So <code>X.c</code> and <code>y.c</code> are predictors and response valurs for calibration subset. Now let’s calibrate the model and show an information about the model object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m =<span class="st"> </span><span class="kw">pls</span>(X.c, y.c, <span class="dv">7</span>, <span class="dt">scale =</span> T, <span class="dt">info =</span> <span class="st">&quot;Shoesize prediction model&quot;</span>)</code></pre></div>
<pre><code>## Warning in selectCompNum.pls(model): No validation results were found!</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m =<span class="st"> </span><span class="kw">selectCompNum</span>(m, <span class="dv">3</span>)</code></pre></div>
<p>As you can see the procedure is very similar to PCA, here we use 7 latent variables and select 3 first as optimal number. Here is an info for the model object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(m)</code></pre></div>
<pre><code>## 
## PLS model (class pls)
## 
## Call:
## pls.cal(x = x, y = y, ncomp = ncomp, center = center, scale = scale, 
##     method = method, cv = cv, alpha = alpha, coeffs.ci = coeffs.ci, 
##     coeffs.alpha = coeffs.alpha, info = info, light = light, 
##     exclcols = exclcols, exclrows = exclrows, ncomp.selcrit = ncomp.selcrit)
## 
## Major fields:
## $ncomp - number of calculated components
## $ncomp.selected - number of selected components
## $coeffs - object (regcoeffs) with regression coefficients
## $xloadings - vector with x loadings
## $yloadings - vector with y loadings
## $weights - vector with weights
## $calres - results for calibration set
## 
## Try summary(model) and plot(model) to see the model performance.</code></pre>
<p>As expected we see loadings for predictors and responses, matrix with weights, and a special object (<code>regcoeffs</code>) for regression coefficients. The values for regression coefficients are available at <code>m.regcoeffs.values</code> it is an array with dimension <em>nVariables x nComponents x nPredictors</em>. The reason to use the object instead of just an array is mainly for being able to get and plot regression coefficients for different methods. Besides that it is possible to calculate confidence intervals and other statistics for the values using Jack-Knife method (will be show later) which produces extra entities.</p>
<p>The regression coefficients can be shown as plot using either function <code>plotRegcoeffs()</code> for the PLS model object or function <code>plot()</code> for the object with regression coefficients. You need to specify for which predictor (if you have more than one y-variable) and which number of components you want to see the coefficients for. By default it shows values for the optimal number of components and first y-variable as it is shown on example below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))
<span class="kw">plotRegcoeffs</span>(m)
<span class="kw">plotRegcoeffs</span>(m, <span class="dt">ncomp =</span> <span class="dv">2</span>)
<span class="kw">plot</span>(m$coeffs, <span class="dt">ncomp =</span> <span class="dv">3</span>, <span class="dt">type =</span> <span class="st">&#39;h&#39;</span>, <span class="dt">show.labels =</span> T)
<span class="kw">plot</span>(m$coeffs, <span class="dt">ncomp =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-4-1.png" width="864" /></p>
<p>The model keeps regression coefficients calculated for centered and standardized data, without interceptt, etc. Here are the values for three PLS components.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">show</span>(m$coeffs$values[, <span class="dv">3</span>, <span class="dv">1</span>])</code></pre></div>
<pre><code>##       Height       Weight     Hairleng          Age       Income 
##  0.210411676  0.197646483 -0.138824482  0.026613035 -0.000590693 
##         Beer         Wine          Sex         Swim       Region 
##  0.148917913  0.138138095 -0.138824482  0.223962000  0.010392542 
##           IQ 
## -0.088658626</code></pre>
<p>You can get the corrected coefficients, which can be applied directly to the raw data by using method <code>getRegcoeffs()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">show</span>(<span class="kw">getRegcoeffs</span>(m, <span class="dt">ncomp =</span> <span class="dv">3</span>))</code></pre></div>
<pre><code>##                      y1
## Intercept  1.251537e+01
## Height     8.105287e-02
## Weight     5.110732e-02
## Hairleng  -5.375404e-01
## Age        1.147785e-02
## Income    -2.580586e-07
## Beer       6.521476e-03
## Wine       1.253340e-02
## Sex       -5.375404e-01
## Swim       1.164947e-01
## Region     4.024083e-02
## IQ        -2.742712e-02</code></pre>
<p>And, again, similar to PLS, we see results for calibration set</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m$loadings[<span class="dv">1</span>:<span class="dv">4</span>, <span class="dv">1</span>:<span class="dv">4</span>]  </code></pre></div>
<pre><code>## NULL</code></pre>
<p>One can also notice that the model object has a particular field — <code>calres</code>, which is in fact a PCA <em>result object</em> containing results of applying the model to the calibration set. If we look at the object description we will get the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(m$calres)</code></pre></div>
<pre><code>## 
## PLS results (class plsres)
## 
## Call:
## plsres(y.pred = yp, y.ref = y.ref, ncomp.selected = object$ncomp.selected, 
##     xdecomp = xdecomp, ydecomp = ydecomp)
## 
## Major fields:
## $ncomp.selected - number of selected components
## $yp - array with predicted y values
## $y - matrix with reference y values
## $rmse - root mean squared error
## $r2 - coefficient of determination
## $slope - slope for predicted vs. measured values
## $bias - bias for prediction vs. measured values
## $ydecomp - decomposition of y values (ldecomp object)
## $xdecomp - decomposition of x values (ldecomp object)</code></pre>
<p>And if we want to look at scores, here is the way:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m$calres$scores[<span class="dv">1</span>:<span class="dv">4</span>, <span class="dv">1</span>:<span class="dv">4</span>]</code></pre></div>
<pre><code>## NULL</code></pre>
<p>Both model and result objects also have related functions (methods), first of all for visualizing various values (e.g. scores plot, loadings plot, etc.). Some of the functions will be discussed later in this chapter, a full list can be found in help for a proper method.</p>
<p>The <em>result object</em> is also created every time you apply a model to a new data. Like in many built-in R methods, method <code>predict()</code> is used in this case. The first argument of the method is always a model object. Here is a PCA example (assuming we have already built the model):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res =<span class="st"> </span><span class="kw">predict</span>(m, X.t)
<span class="kw">print</span>(res)</code></pre></div>
<pre><code>## 
## PLS results (class plsres)
## 
## Call:
## plsres(y.pred = yp, y.ref = y.ref, ncomp.selected = object$ncomp.selected, 
##     xdecomp = xdecomp, ydecomp = ydecomp)
## 
## Major fields:
## $ncomp.selected - number of selected components
## $yp - array with predicted y values
## $xdecomp - decomposition of x values (ldecomp object)</code></pre>
</div>
<div id="model-validation" class="section level3 unnumbered">
<h3>Model validation</h3>
<p>Any model can be validated with cross-validation or/and test set validation. The validation results are, of course, represented by <em>result objects</em>, which are fields of a <em>model object</em> similar to <code>calres</code>, but with names <code>cvres</code> and <code>testres</code> correspondingly.</p>
<p>Here is how to build a PCA model with full cross-validation and test set validation (we will use <code>X.t</code> as test data) at the same time:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m =<span class="st"> </span><span class="kw">pca</span>(X.c, <span class="dv">7</span>, <span class="dt">scale =</span> T, <span class="dt">cv =</span> <span class="dv">1</span>, <span class="dt">x.test =</span> X.t, <span class="dt">info =</span> <span class="st">&quot;PCA model&quot;</span>)
m =<span class="st"> </span><span class="kw">selectCompNum</span>(m, <span class="dv">5</span>)</code></pre></div>
<p>Parameter <code>cv</code> specifies options for cross-validation. If a numeric value is provided then it will be used as number of segments for random cross-validation, e.g. if <code>cv = 2</code> cross-validation with two segments will be used. For full cross-validation use <code>cv = 1</code> like we did in the example above (this is perhaps a bit misleading, but I keep this option for compatability). For more advanced option you can provide a list with name of cross-validation method, number of segments and number of iterations, e.g. <code>cv = list('rand', 4, 4)</code> for running random cross-validation with four segments and four repetitions.</p>
<p>And here is the model object info:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(m)</code></pre></div>
<pre><code>## 
## PCA model (class pca)
## 
## 
## Call:
## pca(x = X.c, ncomp = 7, scale = T, cv = 1, x.test = X.t, info = &quot;PCA model&quot;)
## 
## Major fields:
## $loadings - matrix with loadings
## $eigenvals - eigenvalues for components
## $ncomp - number of calculated components
## $ncomp.selected - number of selected components
## $center - values for centering data
## $scale - values for scaling data
## $cv - number of segments for cross-validation
## $alpha - significance level for Q residuals
## $calres - results (scores, etc) for calibration set
## $cvres - results for cross-validation
## $testres - results for test set</code></pre>
<p>As you can see we have all three types of results now — calibration (<code>calres</code>), cross-validation (<code>cvres</code>) and test set validation (<code>testres</code>). Let us compare, for example, the explained variance values for the results:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">var =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">cal =</span> m$calres$expvar, <span class="dt">cv =</span> m$cvres$expvar, <span class="dt">test =</span> m$testres$expvar)
<span class="kw">show</span>(<span class="kw">round</span>(var, <span class="dv">1</span>))</code></pre></div>
<pre><code>##         cal   cv test
## Comp 1 50.9 39.0 42.1
## Comp 2 21.7 22.2 17.2
## Comp 3 14.3 16.3 18.4
## Comp 4  8.5 14.1  8.7
## Comp 5  2.4  3.7  5.0
## Comp 6  1.2  2.3  2.6
## Comp 7  0.5  0.9  0.6</code></pre>
<p>Every model and every result has a method <code>summary()</code>, which shows some statistics for evaluation of a model performance. Here are some examples.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(m)</code></pre></div>
<pre><code>## 
## PCA model (class pca) summary
## 
## Info:
## PCA model
## 
##        Eigvals Expvar Cumexpvar
## Comp 1   5.597  50.88     50.88
## Comp 2   2.386  21.69     72.57
## Comp 3   1.571  14.29     86.86
## Comp 4   0.935   8.50     95.36
## Comp 5   0.260   2.36     97.72
## Comp 6   0.137   1.24     98.96
## Comp 7   0.056   0.51     99.47</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(m$calres)</code></pre></div>
<pre><code>## 
## Summary for PCA results 
## 
## Selected components: 5
## 
##        Expvar Cumexpvar
## Comp 1  50.88     50.88
## Comp 2  21.69     72.57
## Comp 3  14.29     86.86
## Comp 4   8.50     95.36
## Comp 5   2.36     97.72
## Comp 6   1.24     98.96
## Comp 7   0.51     99.47</code></pre>
<p>The same methodology is used for any other method, e.g. PLS or SIMCA. In the next section we will look at how to use plotting functions for models and results.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="partial-least-squares-regression.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="plotting-methods.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 1
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
